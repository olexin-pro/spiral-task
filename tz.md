# Техническое задание:
Система управления задачами с подзадачами на Spiral Framework

## **Цель проекта**:
Разработать простое приложение для управления задачами с подзадачами, чтобы изучить возможности Spiral Framework. Приложение должно охватывать ключевые особенности фреймворка, такие как роутеры, контроллеры, миграции, репозитории, сервисы, а также возможности работы с запросами и ORM.

---

### **Основные сущности**:

1. **Задача (Task)**:
    - Атрибуты:
        - `id` (Primary Key) — идентификатор задачи
        - `title` — заголовок задачи
        - `description` — описание задачи
        - `status` — статус задачи (например, "Ожидает", "В процессе", "Завершена")
        - `priority` — приоритет задачи (например, "Низкий", "Средний", "Высокий")
        - `due_date` — срок выполнения задачи
        - `created_at` — дата и время создания задачи
        - `updated_at` — дата и время последнего обновления задачи
        - `parent_task_id` — внешний ключ на основную задачу для подзадач (если задача является подзадачей)

2. **Уведомление (Notification)**:
    - Атрибуты:
      - `id`: (int) — уникальный идентификатор уведомления (PK).
      - `user_id`: (int, FK) — идентификатор пользователя, которому отправляется уведомление.
      - `task_id`: (int, FK) — идентификатор задачи, связанной с уведомлением.
      - `message`: (string) — сообщение уведомления.
      - `created_at`: (timestamp) — дата и время отправки уведомления.
      - `read`: (boolean) — прочитал ли пользователь уведомление.

3. ** Пользователь (User)**:
    - Атрибуты:
      - `id`: (int) — уникальный идентификатор пользователя (PK).
      - `name`: (string) — имя пользователя.
      - `email`: (string) — электронная почта пользователя (уникальная).
      - `password`: (string) — зашифрованный пароль пользователя.
      - `role`: (enum: "admin", "user") — роль пользователя (администратор или обычный пользователь).
      - `created_at`: (timestamp) — дата и время регистрации.
      - `updated_at`: (timestamp) — дата и время последнего обновления данных.

---

### **Функциональные требования**:

1. **Основные операции с задачами**:
    - **Создание задачи**: Пользователь может создать новую задачу с заголовком, описанием, приоритетом, статусом и сроком выполнения.
    - **Редактирование задачи**: Пользователь может обновить информацию о задаче, включая статус, приоритет и срок выполнения.
    - **Удаление задачи**: Пользователь может удалить задачу. Если задача имеет подзадачи, то они должны быть удалены вместе с основной задачей.
    - **Просмотр списка задач**: Пользователь может просматривать список всех задач. Задачи могут быть отфильтрованы по статусу, приоритету и сроку выполнения.
    - **Назначение подзадач**: Пользователь может создать подзадачу для основной задачи. Подзадача имеет те же атрибуты, что и задача, и может быть отфильтрована по статусу и приоритету.

2. **Основные операции с подзадачами**:
    - **Создание подзадачи**: Подзадача создается и связана с основной задачей через `task_id`.
    - **Редактирование подзадачи**: Пользователь может обновить подзадачу (статус, приоритет, срок выполнения).
    - **Удаление подзадачи**: Удаление подзадачи возможно только отдельно от основной задачи.
    - **Просмотр подзадач**: Подзадачи могут быть отображены отдельно или в рамках основной задачи.

3. **Роли и разрешения**:
    - Для каждой задачи и подзадачи можно задавать **пользователя**, который отвечает за выполнение задачи (например, через `assigned_user_id`).
    - Администратор может просматривать, редактировать и удалять все задачи, а обычные пользователи могут работать только с задачами, к которым они имеют доступ.

---

### **Технические аспекты (Spiral Framework)**:

1. **Роутинг и контроллеры**:
    - **Контроллеры**: Создать контроллеры для управления задачами (`TaskController`) и подзадачами (`SubtaskController`).
    - **Роутинг**: Осуществить настройку RESTfull маршрутов для выполнения CRUD-операций (создание, чтение, обновление, удаление) для задач и подзадач.
        - Пример маршрута: `GET /tasks` — для отображения списка задач, `POST /tasks` — для создания задачи.

2. **ORM и миграции**:
    - Использовать **Spiral ORM** для работы с базой данных. Создать миграции для таблиц задач и подзадач, с учётом внешнего ключа `parent_task_id` для реализации подзадач.
    - Реализовать репозитории для задач и подзадач, которые инкапсулируют всю логику взаимодействия с базой данных.

3. **Сервисы и бизнес-логика**:
    - Реализовать сервисы для задач и подзадач, которые инкапсулируют бизнес-логику (например, определение приоритета задачи, статус и т.д.).
    - В сервисах также можно добавлять проверки, такие как валидность данных (например, проверка корректности сроков или статусов задач).

4. **Обработка запросов и ответов**:
    - Использовать **request/response** объекты Spiral для обработки входящих данных и формата ответа.
    - Пример: проверка и валидация данных запроса для создания задачи, возврат соответствующего ответа в случае успешной операции или ошибки.

5. **Работа с событиями**:
    - Добавить поддержку **событий** (например, при изменении статуса задачи можно отправить уведомление пользователю или обновить другие связанные задачи).

---

### **Производительность и масштабируемость**:
- **Кэширование**: Можно добавить кэширование часто запрашиваемых данных, таких как список задач, с использованием встроенных средств Spiral.
- **Тестирование**: Реализовать тесты для бизнес-логики задач и подзадач с использованием тестовых библиотек Spiral.

---

### **Ожидаемые результаты**:
- Полная система для управления задачами и подзадачами с поддержкой основных операций CRUD.
- Проект позволяет ознакомиться с ключевыми аспектами Spiral Framework, такими как маршруты, контроллеры, ORM, репозитории и сервисы.
- Структура данных гибкая и позволяет реализовать как простое приложение, так и расширять его в будущем.
